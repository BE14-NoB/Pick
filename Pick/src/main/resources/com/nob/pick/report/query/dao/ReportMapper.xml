<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "https://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.nob.pick.report.query.dao.ReportMapper">

    <!--               REPORT_REASON 테이블              -->
    <resultMap type="com.nob.pick.report.query.dto.ReportReasonDTO" id="reportReasonMap">
        <id property="id" column="ID"/>
        <result property="reason" column="REASON"/>
    </resultMap>

<!--                    REPORT 테이블                    -->
    <resultMap type="com.nob.pick.report.query.dto.ReportDTO" id="reportResultMap">
        <id property="id" column="ID"/>
        <result property="reportedAt" column="REPORTED_AT"/>
        <result property="status" column="STATUS" typeHandler="com.nob.pick.report.query.dto.typehandler.ReportStatusEnumTypeHandler"/>
        <result property="category" column="CATEGORY" typeHandler="com.nob.pick.report.query.dto.typehandler.ReportCategoryEnumTypeHandler"/>
        <result property="reportedId" column="REPORTED_ID"/>
        <result property="reportReasonId" column="REPORT_REASON_ID"/>
        <result property="memberId" column="MEMBER_ID"/>
    </resultMap>


    <select id="selectAllReports" resultMap="reportResultMap">
        SELECT
               R.ID
             , R.REPORTED_AT
             , R.STATUS
             , R.CATEGORY
             , R.REPORTED_ID
             , R.REPORT_REASON_ID
             , R.MEMBER_ID
             , RR.REASON
             , M.ID                   AS 신고자
          FROM REPORT R
          JOIN REPORT_REASON RR ON (R.REPORT_REASON_ID = RR.ID)
          JOIN MEMBER M ON R.MEMBER_ID = M.ID;
    </select>
</mapper>